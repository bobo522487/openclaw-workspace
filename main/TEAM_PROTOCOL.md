# 团队协作协议

## 核心原则

> "信号优于噪音。交付物优于状态更新。质量优于速度。"

---

## 禁止垃圾邮件规则

### 状态报告规范

**禁止**：
- ❌ "正在工作中..."
- ❌ "还在思考..."
- ❌ "查看了文件..."
- ❌ "正在等待..."

**允许**：
- ✅ "DELIVERABLE: PR 已提交 [链接]"
- ✅ "BLOCKER: 无法访问数据库，需要权限"
- ✅ 发现了关键问题，需要决策

### 规则总结

| 消息类型 | 是否允许 |
|----------|----------|
| 交付物完成 | ✅ 立即发送 |
| 遇到阻塞 | ✅ 立即发送 |
| 发现安全风险 | ✅ 立即发送 |
| 进度更新 | ❌ 除非被询问 |
| 闲聊 | ❌ 永远禁止 |

---

## 交付物格式

### 标准交付物格式

```markdown
## DELIVERABLE: [简短描述]

### 内容
- [具体交付内容]
- [相关链接]
- [文件路径]

### 状态
- 状态: [完成/部分完成/失败]
- 后续: [下一步或需要行动]

### 元数据
- 代理: [代理名称]
- 时间: [时间戳]
```

### PR 交付格式

```markdown
## DELIVERABLE: PR [PR编号/标题]

### 链接
[PR 链接]

### 变更摘要
- [变更描述]

### 测试
- [测试状态]

### 审查
- 需要 qa 审查: 是/否
```

### 审查交付格式

```markdown
## DELIVERABLE: [审查类型] 审查报告

### 总体评估
- 评级: [批准/有条件批准/拒绝]
- 严重性: [Critical/High/Medium/Low]

### 发现
1. [问题1] - 严重性
2. [问题2] - 严重性
...

### 建议
- [修复建议]
```

### 调研交付格式

```markdown
## DELIVERABLE: [调研主题] 调研报告

### 执行摘要
- [3-5 句话总结]

### 关键发现
1. [发现1]
2. [发现2]
...

### 详细信息
- [详细内容]

### 参考资料
- [链接1]
- [链接2]
```

---

## 阻塞报告格式

```markdown
## BLOCKER: [阻塞描述]

### 问题
- [问题描述]

### 影响
- [影响范围]

### 需要的行动
- [需要的帮助或决策]

### 代理
- [代理名称]
```

---

## 标记纪律

### 何时标记编排器 (main)

**立即标记**：
- 发现安全漏洞
- 任务无法完成
- 需要用户决策
- 超出权限范围

**等待完成**：
- 正常任务执行
- 预期内的困难
- 可以自行解决的问题

### 何时标记用户

**通过编排器**：
- 任务完成
- 需要决策
- 发现重要问题

**不直接标记**：
- 代理间协调
- 状态更新
- 小问题

---

## Slack 通信规范

### 频道使用

| 频道 | 用途 |
|------|------|
| #general | 交付物和重要公告 |
| #alerts | 阻塞和安全问题 |
| #coordination | 代理间协调（如需要） |

### 消息格式

```markdown
[代理] [类型] [内容]

示例:
[dev] DELIVERABLE: PR #123 已提交
[qa] BLOCKER: 发现 SQL 注入风险
[res] DELIVERABLE: API 调研完成
```

### 标记规则

- 只在必要时标记
- 优先使用频道而非 DM
- 编排器是主要的用户联系人

---

## 交接规则

### 标准交接

1. **当前代理**完成交付物
2. **标记为 DELIVERABLE**
3. **编排器**接收并综合
4. 如需要，创建**下一个代理**

### 并行交接

1. **编排器**创建多个代理
2. 每个代理**独立工作**
3. 所有代理完成后**通告结果**
4. **编排器**综合所有结果

### 紧急交接

1. **当前代理**发现紧急问题
2. 立即标记为 **BLOCKER**
3. **编排器**评估并决定下一步
4. 可能创建新代理或升级到用户

---

## 文件共享规则

### 读取权限

- main: 完全访问
- dev: 代码读写
- qa: 代码只读
- res: 有限访问
- data: 按需访问
- ops: 基础设施访问

### 写入冲突避免

- 每个代理负责不同文件集
- 如需编辑同一文件，通过编排器协调
- 使用 Git 分支隔离工作

---

## 质量标准

### 交付物必须

1. **完整** - 包含所有承诺的内容
2. **可验证** - 可以检查和测试
3. **可链接** - PR、文档、报告有链接
4. **清晰** - 不需要额外解释

### 不完整交付物

如果无法完成完整交付物：

1. 标记为 PARTIAL
2. 说明已完成部分
3. 解释未完成原因
4. 建议如何完成

---

## 违规处理

### 首次违规

- 警告
- 提醒协议
- 要求修正

### 重复违规

- 限制权限
- 增加审查
- 必要时重新配置

### 严重违规

- 立即停止工作
- 升级到编排器
- 根因分析和修正
